<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Sudan PFP Maker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; display:flex; align-items:center; justify-content:center; min-height:100vh; gap:20px; padding:20px; background:#f7f7f8; }
    .card { background:white; padding:18px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); width:360px; max-width:100%; text-align:center; }
    canvas { width: 100%; height: auto; border-radius:50%; background:#eee; }
    input, button { margin-top:12px; width:100%; padding:10px; font-size:16px; border-radius:8px; border:1px solid #ddd; }
    button { cursor:pointer; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Sudan PFP Maker</h2>
    <input id="file" type="file" accept="image/*" />
    <canvas id="preview" width="512" height="512" style="display:block;margin:12px auto 0;"></canvas>
    <button id="download" disabled>Download PFP</button>
    <p style="font-size:12px;color:#666;margin-top:8px;">Replace <code>sudan-border.png</code> with your border image (transparent center)</p>
  </div>

  <script>
    const fileInput = document.getElementById('file');
    const canvas = document.getElementById('preview');
    const ctx = canvas.getContext('2d');
    const downloadBtn = document.getElementById('download');

    // Load the border overlay (transparent inside)
    const overlay = new Image();
    overlay.src = 'sudan-border.png'; // put your border file here (transparent center, square)
    overlay.onload = () => {
      // optional: draw overlay placeholder until user uploads
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#ddd';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      const size = canvas.width * 0.9;
      ctx.drawImage(overlay, 0, 0, canvas.width, canvas.height);
    };

    function resetCanvas() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#eee';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(overlay, 0, 0, canvas.width, canvas.height);
    }

    fileInput.addEventListener('change', async (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) { downloadBtn.disabled = true; resetCanvas(); return; }

      const img = new Image();
      img.onload = () => {
        // We'll draw a square crop to fit inside the canvas (center-crop)
        const cw = canvas.width;
        const ch = canvas.height;

        // compute source crop box for center-crop square
        let sx = 0, sy = 0, s = 0;
        if (img.width > img.height) {
          // wide image -> crop sides
          s = img.height;
          sx = Math.round((img.width - s) / 2);
          sy = 0;
        } else {
          // tall or square -> crop top/bottom
          s = img.width;
          sx = 0;
          sy = Math.round((img.height - s) / 2);
        }

        // draw the user image into the canvas
        ctx.clearRect(0,0,cw,ch);
        ctx.drawImage(img, sx, sy, s, s, 0, 0, cw, ch);

        // draw the overlay on top (should have transparent center)
        if (overlay.complete) {
          ctx.drawImage(overlay, 0, 0, cw, ch);
        } else {
          overlay.onload = () => ctx.drawImage(overlay, 0, 0, cw, ch);
        }

        downloadBtn.disabled = false;
      };

      // load file as data URL
      const reader = new FileReader();
      reader.onload = (e) => { img.src = e.target.result; };
      reader.readAsDataURL(f);
    });

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      // Export as PNG with transparency if overlay uses it
      link.href = canvas.toDataURL('image/png');
      link.download = 'sudan-pfp.png';
      link.click();
    });

    // init
    resetCanvas();
  </script>
</body>
</html>
